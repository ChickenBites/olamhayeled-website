<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>×ª×©×œ×•××™× - ×¢×•×œ× ×”×™×œ×“</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="× ×™×”×•×œ ×ª×©×œ×•××™× - ×ª×©×œ×•× ×—×•×“×©×™ ×©×œ 3500 â‚ª" />
  
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: "Alef","Assistant",Arial,sans-serif; }
    body { background: #FFF9E6; color: #5D4037; line-height: 1.6; }
    a { text-decoration: none; color: inherit; }
    
    .container { max-width: 800px; margin: 0 auto; padding: 1.5rem; }
    
    header {
      background: linear-gradient(135deg, #FF6B6B, #FFE66D, #4ECDC4, #95E1D3);
      background-size: 300% 300%;
      animation: rainbow 10s ease infinite;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      text-align: center;
    }
    
    @keyframes rainbow {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    header h1 { color: #fff; text-shadow: 2px 2px 4px rgba(0,0,0,0.2); }
    header p { color: #fff; font-weight: 500; text-shadow: 1px 1px 3px rgba(0,0,0,0.2); }
    
    .back-link {
      display: inline-block;
      margin-bottom: 1rem;
      color: #4ECDC4;
      font-weight: 600;
    }
    
    .back-link:hover { color: #FF6B6B; }
    
    .payment-summary {
      background: linear-gradient(135deg, #4ECDC4, #95E1D3);
      padding: 1.5rem;
      border-radius: 15px;
      margin-bottom: 2rem;
      color: #fff;
      text-align: center;
    }
    
    .payment-amount { font-size: 2.5rem; font-weight: bold; margin: 0.5rem 0; }
    .payment-frequency { font-size: 1.1rem; opacity: 0.9; }
    
    .section {
      background: #fff;
      padding: 2rem;
      border-radius: 20px;
      margin-bottom: 1.5rem;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    }
    
    h2 { color: #FF6B6B; margin-bottom: 1rem; }
    h3 { color: #4ECDC4; margin-bottom: 0.8rem; }
    
    .payment-type-selector { display: flex; gap: 1rem; margin-bottom: 1.5rem; }
    
    .payment-type-btn {
      flex: 1;
      padding: 1rem;
      border: 2px solid #ddd;
      border-radius: 15px;
      background: #fff;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
    }
    
    .payment-type-btn:hover { border-color: #4ECDC4; }
    .payment-type-btn.active { border-color: #FF6B6B; background: #FFF5F5; }
    .payment-type-btn .icon { font-size: 2rem; display: block; margin-bottom: 0.5rem; }
    .payment-type-btn .label { font-weight: 600; color: #5D4037; }
    
    .form-group { margin-bottom: 1rem; }
    .form-group label { display: block; color: #4ECDC4; font-weight: 600; margin-bottom: 5px; }
    .form-group input, .form-group select {
      width: 100%;
      padding: 0.8rem;
      border-radius: 10px;
      border: 2px solid #95E1D3;
      font-size: 1rem;
      transition: border-color 0.3s;
    }
    .form-group input:focus, .form-group select:focus {
      border-color: #FFE66D;
      outline: none;
    }
    
    .form-row { display: flex; gap: 1rem; }
    .form-row .form-group { flex: 1; }
    
    .btn {
      padding: 1rem 2rem;
      border-radius: 25px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: transform 0.2s, box-shadow 0.2s;
      font-size: 1rem;
    }
    .btn-primary { 
      background: linear-gradient(135deg, #FF6B6B, #FFE66D); 
      color: #fff;
      width: 100%;
    }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
    .btn:disabled { opacity: 0.6; cursor: not-allowed; }
    
    .payment-form { display: none; }
    .payment-form.active { display: block; }
    
    .success-message {
      background: #D4EDDA;
      border: 2px solid #28A745;
      color: #155724;
      padding: 1rem;
      border-radius: 10px;
      margin-bottom: 1rem;
      display: none;
    }
    .success-message.show { display: block; }
    
    .error-message {
      background: #F8D7DA;
      border: 2px solid #DC3545;
      color: #721C24;
      padding: 1rem;
      border-radius: 10px;
      margin-bottom: 1rem;
      display: none;
    }
    .error-message.show { display: block; }
    
    .card-icons { display: flex; gap: 0.5rem; margin-bottom: 0.5rem; }
    .card-icon { padding: 0.3rem 0.6rem; border-radius: 5px; font-size: 0.8rem; background: #eee; color: #666; }
    .card-icon.visa { background: #1A1F71; color: #fff; }
    .card-icon.mastercard { background: #EB001B; color: #fff; }
    .card-icon.isracard { background: #0066B3; color: #fff; }
    
    .standing-order-note {
      background: #FFF3CD;
      border: 2px solid #FFC107;
      padding: 1rem;
      border-radius: 10px;
      margin-bottom: 1rem;
      font-size: 0.9rem;
    }
    
    .bank-list { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem; margin-bottom: 1rem; }
    .bank-option { padding: 0.5rem; border: 2px solid #ddd; border-radius: 8px; text-align: center; cursor: pointer; font-size: 0.85rem; }
    .bank-option:hover { border-color: #4ECDC4; }
    .bank-option.selected { border-color: #FF6B6B; background: #FFF5F5; }
    
    .hidden { display: none !important; }
    
    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
      margin-left: 10px;
      vertical-align: middle;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    
    footer { text-align: center; padding: 1.5rem; color: #5D4037; font-size: 0.9rem; }
    
    @media (max-width: 600px) {
      .payment-type-selector { flex-direction: column; }
      .form-row { flex-direction: column; }
      .bank-list { grid-template-columns: repeat(2, 1fr); }
    }
  </style>
</head>
<body>

<header>
  <div class="container">
    <h1>ğŸ’° ×ª×©×œ×•××™× - ×¢×•×œ× ×”×™×œ×“</h1>
    <p>××©×¤×—×ª×•×Ÿ ×‘×™×ª×™ ×‘×’×™×©×” ×”×ª×¤×ª×—×•×ª×™×ª-×ª× ×•×¢×ª×™×ª</p>
  </div>
</header>

<main class="container">
  <a href="index.html" class="back-link">â† ×—×–×¨×” ×œ×“×£ ×”×‘×™×ª</a>
  
  <div id="successMessage" class="success-message"></div>
  <div id="errorMessage" class="error-message"></div>
  
  <div class="payment-summary">
    <div>×ª×©×œ×•× ×—×•×“×©×™</div>
    <div class="payment-amount">â‚ª3,500</div>
    <div class="payment-frequency">××©×¤×—×ª×•×Ÿ ×¢×•×œ× ×”×™×œ×“</div>
  </div>
  
  <section class="section">
    <h2>ğŸ‘¤ ×¤×¨×˜×™ ×”×•×¨×” ×•×™×œ×“</h2>
    <form id="customerForm">
      <div class="form-row">
        <div class="form-group">
          <label>×©× ×”×”×•×¨×” *</label>
          <input type="text" id="parentName" required placeholder="×©× ××œ×" />
        </div>
        <div class="form-group">
          <label>×˜×œ×¤×•×Ÿ *</label>
          <input type="tel" id="phone" required placeholder="05X-XXX-XXXX" />
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>××™××™×™×œ</label>
          <input type="email" id="email" placeholder="email@example.com" />
        </div>
        <div class="form-group">
          <label>×©× ×”×™×œ×“/×” *</label>
          <input type="text" id="childName" required placeholder="×©× ×”×™×œ×“/×”" />
        </div>
      </div>
    </form>
  </section>
  
  <section class="section">
    <h2>ğŸ’³ ×‘×—×™×¨×ª ×××¦×¢×™ ×ª×©×œ×•×</h2>
    
    <div class="payment-type-selector">
      <button type="button" class="payment-type-btn active" data-type="credit_card">
        <span class="icon">ğŸ’³</span>
        <span class="label">×›×¨×˜×™×¡ ××©×¨××™</span>
      </button>
      <button type="button" class="payment-type-btn" data-type="standing_order">
        <span class="icon">ğŸ¦</span>
        <span class="label">×”×•×¨××ª ×§×‘×¢</span>
      </button>
    </div>
    
    <div id="creditCardForm" class="payment-form active">
      <h3>×¤×¨×˜×™ ×›×¨×˜×™×¡ ××©×¨××™</h3>
      <div class="card-icons">
        <span class="card-icon visa">Visa</span>
        <span class="card-icon mastercard">Mastercard</span>
        <span class="card-icon isracard">Isracard</span>
      </div>
      
      <form id="ccForm">
        <div class="form-group">
          <label>××¡×¤×¨ ×›×¨×˜×™×¡ *</label>
          <input type="text" id="cardNumber" maxlength="19" placeholder="XXXX XXXX XXXX XXXX" required />
        </div>
        
        <div class="form-group">
          <label>×©× ×‘×¢×œ ×”×›×¨×˜×™×¡ *</label>
          <input type="text" id="cardHolder" placeholder="×©× ×›×¤×™ ×©××•×¤×™×¢ ×¢×œ ×”×›×¨×˜×™×¡" required />
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label>×—×•×“×© *</label>
            <select id="cardMonth" required>
              <option value="">×—×•×“×©</option>
              <option value="01">01</option><option value="02">02</option><option value="03">03</option>
              <option value="04">04</option><option value="05">05</option><option value="06">06</option>
              <option value="07">07</option><option value="08">08</option><option value="09">09</option>
              <option value="10">10</option><option value="11">11</option><option value="12">12</option>
            </select>
          </div>
          <div class="form-group">
            <label>×©× ×” *</label>
            <select id="cardYear" required>
              <option value="">×©× ×”</option>
              <option value="2025">2025</option><option value="2026">2026</option><option value="2027">2027</option>
              <option value="2028">2028</option><option value="2029">2029</option><option value="2030">2030</option>
              <option value="2031">2031</option><option value="2032">2032</option><option value="2033">2033</option>
              <option value="2034">2034</option><option value="2035">2035</option>
            </select>
          </div>
          <div class="form-group">
            <label>CVV *</label>
            <input type="text" id="cardCvv" maxlength="4" placeholder="XXX" required />
          </div>
        </div>
        
        <div class="form-group">
          <label>×ª××¨×™×š ×ª×—×™×œ×ª ×”×•×¨××ª ×”×§×‘×¢ *</label>
          <input type="date" id="startDate" required />
        </div>
        
        <button type="submit" class="btn btn-primary" id="submitCCBtn">
          ×”×¨×©× ×œ×ª×©×œ×•× ×—×•×“×©×™
        </button>
      </form>
    </div>
    
    <div id="standingOrderForm" class="payment-form">
      <h3>×¤×¨×˜×™ ×”×•×¨××ª ×§×‘×¢ (×“×‘×™×˜)</h3>
      
      <div class="standing-order-note">
        ğŸ“ <strong>×”×•×¨××ª ×§×‘×¢</strong> - ×”×ª×©×œ×•× ×™×’×‘×” ××•×˜×•××˜×™×ª ××”×—×©×‘×•×Ÿ ×©×œ×š ×‘×›×œ ×—×•×“×©.
      </div>
      
      <div class="bank-list">
        <div class="bank-option selected" data-bank="001">×‘× ×§ ×œ××•××™</div>
        <div class="bank-option" data-bank="004">×‘× ×§ ××–×¨×—×™</div>
        <div class="bank-option" data-bank="007">×‘× ×§ ×“×™×¡×§×•× ×˜</div>
        <div class="bank-option" data-bank="010">×‘× ×§ ×”×¤×•×¢×œ×™×</div>
        <div class="bank-option" data-bank="012">×‘× ×§ ×™×”×‘</div>
        <div class="bank-option" data-bank="013">×‘× ×§ ×™×¨×•×©×œ×™×</div>
      </div>
      
      <form id="soForm">
        <div class="form-row">
          <div class="form-group">
            <label>×§×•×“ ×‘× ×§ *</label>
            <input type="text" id="bankCode" placeholder="XXX" maxlength="3" required />
          </div>
          <div class="form-group">
            <label>××¡×¤×¨ ×¡× ×™×£ *</label>
            <input type="text" id="branchCode" placeholder="XXX" maxlength="3" required />
          </div>
        </div>
        
        <div class="form-group">
          <label>××¡×¤×¨ ×—×©×‘×•×Ÿ *</label>
          <input type="text" id="accountNumber" placeholder="××¡×¤×¨ ×—×©×‘×•×Ÿ" maxlength="9" required />
        </div>
        
        <div class="form-group">
          <label>×©× ×‘×¢×œ ×”×—×©×‘×•×Ÿ *</label>
          <input type="text" id="accountHolder" placeholder="×©× ××œ×" required />
        </div>
        
        <div class="form-group">
          <label>×ª××¨×™×š ×ª×—×™×œ×ª ×”×•×¨××ª ×”×§×‘×¢ *</label>
          <input type="date" id="soStartDate" required />
        </div>
        
        <button type="submit" class="btn btn-primary" id="submitSOBtn">
          ×”×¨×©× ×œ×ª×©×œ×•× ×—×•×“×©×™
        </button>
      </form>
    </div>
  </section>
  
  <section class="section hidden" id="confirmationSection">
    <h2>âœ… ×”×¨×™×©×•× ×”×•×©×œ×</h2>
    <div id="confirmationContent"></div>
  </section>

</main>

<footer>
  <p>Â© 2024 ×¢×•×œ× ×”×™×œ×“ - ××©×¤×—×ª×•×Ÿ ×‘×™×ª×™ | ×›×œ ×”×–×›×•×™×•×ª ×©××•×¨×•×ª</p>
  <p>ğŸ’³ ×ª×©×œ×•× ×××•×‘×˜×— | ğŸ”’ ××•×’×Ÿ ×‘×¤×¨×•×˜×•×§×•×œ SSL</p>
</footer>

<script>
// Netlify Functions API base URL
const API_BASE = '/.netlify/functions/payment';
const MONTHLY_AMOUNT = 3500;

let customerId = null;
let selectedPaymentType = 'credit_card';

// Initialize
document.addEventListener('DOMContentLoaded', () => {
  const today = new Date().toISOString().split('T')[0];
  document.getElementById('startDate').value = today;
  document.getElementById('soStartDate').value = today;
  document.getElementById('startDate').min = today;
  document.getElementById('soStartDate').min = today;
});

// Payment type selection
document.querySelectorAll('.payment-type-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.payment-type-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    selectedPaymentType = btn.dataset.type;
    
    if (selectedPaymentType === 'credit_card') {
      document.getElementById('creditCardForm').classList.add('active');
      document.getElementById('standingOrderForm').classList.remove('active');
    } else {
      document.getElementById('creditCardForm').classList.remove('active');
      document.getElementById('standingOrderForm').classList.add('active');
    }
  });
});

// Bank selection
document.querySelectorAll('.bank-option').forEach(opt => {
  opt.addEventListener('click', () => {
    document.querySelectorAll('.bank-option').forEach(b => b.classList.remove('selected'));
    opt.classList.add('selected');
    document.getElementById('bankCode').value = opt.dataset.bank;
  });
});

// Format card number
document.getElementById('cardNumber').addEventListener('input', (e) => {
  let value = e.target.value.replace(/\D/g, '');
  value = value.replace(/(\d{4})/g, '$1 ').trim();
  e.target.value = value;
});

// Credit Card Form Submit
document.getElementById('ccForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  
  const btn = document.getElementById('submitCCBtn');
  btn.disabled = true;
  btn.innerHTML = '××¢×‘×“... <span class="spinner"></span>';
  
  hideMessages();
  
  try {
    // Step 1: Register customer
    const customerData = {
      parent_name: document.getElementById('parentName').value,
      phone: document.getElementById('phone').value,
      email: document.getElementById('email').value,
      child_name: document.getElementById('childName').value
    };
    
    let response = await fetch(API_BASE + '/register', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(customerData)
    });
    
    let result = await response.json();
    if (!result.success) throw new Error(result.error);
    customerId = result.customer_id;
    
    // Step 2: Add credit card
    const cardData = {
      customer_id: customerId,
      card_number: document.getElementById('cardNumber').value.replace(/\s/g, ''),
      card_holder_name: document.getElementById('cardHolder').value,
      expiry_month: document.getElementById('cardMonth').value,
      expiry_year: document.getElementById('cardYear').value,
      cvv: document.getElementById('cardCvv').value
    };
    
    response = await fetch(API_BASE + '/add-credit-card', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(cardData)
    });
    
    result = await response.json();
    if (!result.success) throw new Error(result.error);
    
    // Step 3: Create recurring payment
    const recurringData = {
      customer_id: customerId,
      payment_method_id: result.method_id,
      amount: MONTHLY_AMOUNT,
      start_date: document.getElementById('startDate').value,
      frequency: 'monthly'
    };
    
    response = await fetch(API_BASE + '/create-recurring', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(recurringData)
    });
    
    result = await response.json();
    if (!result.success) throw new Error(result.error);
    
    showSuccess(`
      <h3>ğŸ‰ ×”×¨×™×©×•× ×”×•×©×œ× ×‘×”×¦×œ×—×”!</h3>
      <p>× ×•×¦×¨ ×ª×©×œ×•× ×—×•×“×©×™ ×©×œ <strong>â‚ª${MONTHLY_AMOUNT.toLocaleString()}</strong></p>
      <p>×”×ª×©×œ×•× ×™×ª×‘×¦×¢ ×‘××•×¤×Ÿ ××•×˜×•××˜×™ ××“×™ ×—×•×“×© ×”×—×œ ××ª××¨×™×š <strong>${formatDate(document.getElementById('startDate').value)}</strong></p>
      <p>×¤×¨×˜×™ ×”×ª×©×œ×•×:</p>
      <ul style="text-align: right; margin: 10px 0;">
        <li>×¡×•×’ ×ª×©×œ×•×: ×›×¨×˜×™×¡ ××©×¨××™</li>
        <li>××¡×¤×¨ ×›×¨×˜×™×¡: **** ${result.last4 || '****'}</li>
        <li>××¡×¤×¨ ×œ×§×•×—: ${customerId}</li>
      </ul>
      <p style="margin-top: 15px;">×ª×•×“×” ×¨×‘×”! ğŸ§’ğŸ’•</p>
    `);
    
    document.getElementById('confirmationSection').classList.remove('hidden');
    
  } catch (error) {
    showError(error.message);
  } finally {
    btn.disabled = false;
    btn.innerHTML = '×”×¨×©× ×œ×ª×©×œ×•× ×—×•×“×©×™';
  }
});

// Standing Order Form Submit
document.getElementById('soForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  
  const btn = document.getElementById('submitSOBtn');
  btn.disabled = true;
  btn.innerHTML = '××¢×‘×“... <span class="spinner"></span>';
  
  hideMessages();
  
  try {
    const customerData = {
      parent_name: document.getElementById('parentName').value,
      phone: document.getElementById('phone').value,
      email: document.getElementById('email').value,
      child_name: document.getElementById('childName').value
    };
    
    let response = await fetch(API_BASE + '/register', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(customerData)
    });
    
    let result = await response.json();
    if (!result.success) throw new Error(result.error);
    customerId = result.customer_id;
    
    const soData = {
      customer_id: customerId,
      bank_code: document.getElementById('bankCode').value,
      branch_code: document.getElementById('branchCode').value,
      account_number: document.getElementById('accountNumber').value,
      account_holder_name: document.getElementById('accountHolder').value
    };
    
    response = await fetch(API_BASE + '/add-standing-order', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(soData)
    });
    
    result = await response.json();
    if (!result.success) throw new Error(result.error);
    
    const recurringData = {
      customer_id: customerId,
      payment_method_id: result.method_id,
      amount: MONTHLY_AMOUNT,
      start_date: document.getElementById('soStartDate').value,
      frequency: 'monthly'
    };
    
    response = await fetch(API_BASE + '/create-recurring', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(recurringData)
    });
    
    result = await response.json();
    if (!result.success) throw new Error(result.error);
    
    showSuccess(`
      <h3>ğŸ‰ ×”×¨×™×©×•× ×”×•×©×œ× ×‘×”×¦×œ×—×”!</h3>
      <p>× ×•×¦×¨×” ×”×•×¨××ª ×§×‘×¢ ×—×•×“×©×™×ª ×©×œ <strong>â‚ª${MONTHLY_AMOUNT.toLocaleString()}</strong></p>
      <p>×”×ª×©×œ×•× ×™×’×‘×” ××•×˜×•××˜×™×ª ××”×—×©×‘×•×Ÿ ×©×œ×š ×”×—×œ ××ª××¨×™×š <strong>${formatDate(document.getElementById('soStartDate').value)}</strong></p>
      <p>×¤×¨×˜×™ ×”×ª×©×œ×•×:</p>
      <ul style="text-align: right; margin: 10px 0;">
        <li>×¡×•×’ ×ª×©×œ×•×: ×”×•×¨××ª ×§×‘×¢ (×“×‘×™×˜)</li>
        <li>×‘× ×§: ${document.getElementById('bankCode').value}</li>
        <li>×¡× ×™×£: ${document.getElementById('branchCode').value}</li>
        <li>×—×©×‘×•×Ÿ: ****${document.getElementById('accountNumber').value.slice(-4)}</li>
      </ul>
      <p style="margin-top: 15px;">×ª×•×“×” ×¨×‘×”! ğŸ§’ğŸ’•</p>
    `);
    
    document.getElementById('confirmationSection').classList.remove('hidden');
    
  } catch (error) {
    showError(error.message);
  } finally {
    btn.disabled = false;
    btn.innerHTML = '×”×¨×©× ×œ×ª×©×œ×•× ×—×•×“×©×™';
  }
});

function showSuccess(message) {
  document.getElementById('successMessage').innerHTML = message;
  document.getElementById('successMessage').classList.add('show');
  document.getElementById('errorMessage').classList.remove('show');
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function showError(message) {
  document.getElementById('errorMessage').textContent = message;
  document.getElementById('errorMessage').classList.add('show');
  document.getElementById('successMessage').classList.remove('show');
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function hideMessages() {
  document.getElementById('successMessage').classList.remove('show');
  document.getElementById('errorMessage').classList.remove('show');
}

function formatDate(dateStr) {
  const date = new Date(dateStr);
  return date.toLocaleDateString('he-IL', { year: 'numeric', month: 'long', day: 'numeric' });
}
</script>

</body>
</html>
